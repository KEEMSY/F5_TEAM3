{% load static %}
<!DOCTYPE html>
<html lang="ko">
{% include 'head.html' %}
<link rel="stylesheet" href="{% static 'css/comment.css' %}">
<link rel="stylesheet" href="{% static 'css/articleapp/article_write.css' %}">
<link rel="stylesheet" href="{% static 'css/articleapp/article_base.css' %}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    function open_comment() {
        $('#comment_content').removeClass('disp_none')
        $('#more_show_btn').addClass('disp_none')
        $('#less_show_btn').removeClass('disp_none')
    }
    function close_comment() {
        $('#comment_content').addClass('disp_none')
        $('#more_show_btn').removeClass('disp_none')
        $('#less_show_btn').addClass('disp_none')
    }

    function save_comment(){
        let url = window.location.href.split('/')
        let article_id = url[url.length - 1]
        let comment = $('#target_comment').val()
        let temp_html =``
            $.ajax({
                type: "POST",
                url: '{% url 'commentapp:interatction_comment' %}',
                data: {
                    'article_id':article_id,
                    'content':comment
                },
                headers: {
                   'X-CSRFTOKEN' : '{{ csrf_token }}'
                },
                success: function (response) {
                    let username = response['comment']['username']
                    let date = response['comment']['date']
                    let content = response['comment']['content']
                    console.log(username)
                    console.log(date)

                    temp_html = `
                    <div class="timeline-item-description">
                        <i class="avatar | small">
                            <img src="https://assets.codepen.io/285131/hat-man.png"/>
                        </i>
                        <span><a href="#"> ${username} </a>   ÏûëÏÑ±Îêú ÎÇ†Ïßú <time
                                datetime="20-01-2021"> ${date} </time></span>
                    </div>
                    <div class="comment">
                        <p>
                            ${content}
                        </p>
                    </div>`

                    $('#comment_content2').append(temp_html)
                    {#window.location.reload(true)#}

                }
            });

    }

</script>
<body>

<div class="wrapper">
    <!--== Start Header Wrapper ==-->
    {% include 'header.html' %}
    {# End Header Wrpper#}
    <div class="wraper_wraper">

        {% include 'articleapp/article_left_content.html' %}

        <div class="col-8">
            <div class="right_wrapper">
                <div class="content_wrapper">
{#                    <div class="content_img">#}
{#                        Ïó¨Í∏∞Ïóê Ïù¥ÎØ∏ÏßÄÏù¥ Îì§Ïñ¥Í∞ëÎãàÎã§#}
{#                    </div>#}
                    <div class="content_details">
                        <div class="content_title">
                            <h1>
                                {{ target_article.title }}
                            </h1>
                        </div>
                        <div class="content_title_footet">
                            <div class="content_title_footet_left_wrapper">
                            <span>
                                {{ target_article.created_at|date:'Y-m-d H:i' }} by <a href="">{{ target_article.user.username }}</a>
                            </span>
                            </div>
                            <div class="content_title_footet_right_wrapper">
                                <div class="right_wrapper_icons">
                                    <div class="icon_wrapper">
                                        <img src="{% static 'img/icons/hearted.png' %}" alt="">
                                    </div>
                                    <div class="icon_cnt">
                                        <span>{{ target_article.like_cnt }}</span>
                                    </div>
                                </div>
                                <div class="right_wrapper_icons">
                                    <div class="icon_wrapper">
                                        <img src="{% static 'img/icons/comment.png' %}" alt="">
                                    </div>
                                    <div class="icon_cnt">
                                        <span>{{ target_comment.count }}</span>
                                    </div>
                                </div>
                                <div class="right_wrapper_icons">
                                    <div class="icon_wrapper">
                                        <img src="{% static 'img/icons/eye.png' %}" alt="">
                                    </div>
                                    <div class="icon_cnt">
                                        <span>{{ target_article.article_hits }}</span>
                                    </div>
                                </div>
                                <div class="right_wrapper_icons">
                                    <div class="icon_wrapper">
                                        <img src="{% static 'img/icons/bookmark.png' %}" alt="">
                                    </div>
                                    <div class="icon_cnt">
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="content_main">
                        <span>
                            {{ target_article.content}}
                        </span>
                        </div>
                        <br>
                        <hr>
                        <div class="content_comment">
                            <div class="content_best_comment">
                                <ol class="timeline">
                                <li class="timeline-item | extra-space">

                                    <span>
                                        <div style="width: 2rem; height: 2rem;">
                                            <img src="{% static 'img/recommendation.png' %}" alt="">
                                        </div>

                                    </span>
                                    <div class="timeline-item-wrapper" id="comment_here">

                                        <div class="timeline-item-description">
                                            <i class="avatar | small">
                                                <img src="https://assets.codepen.io/285131/hat-man.png"/>
                                            </i>
                                            <span><a href="#">Yoan Almedia</a> commented on <time
                                                    datetime="20-01-2021">Jan 20, 2021</time></span>
                                        </div>
                                        <div class="comment">
                                            <p>I've sent him the assignment we discussed recently, he is coming back
                                                to us this week. Regarding
                                                to
                                                our last call, I really enjoyed talking to him and so far he has the
                                                profile we are looking for.
                                                Can't wait to see his technical test, I'll keep you posted and we'll
                                                debrief it all
                                                together!üòä</p>
                                        </div>
                                        <br>
{#                                ÎåìÍ∏Ä ÏûëÏÑ±#}
                                 {% if user.is_authenticated %}
                                     <li class="timeline-item">
                                        <span class="timeline-item-icon | avatar-icon">
                                            <i class="avatar">
                                                <img src="https://assets.codepen.io/285131/hat-man.png"/>
                                            </i>
                                        </span>
{#                                        ÎåìÍ∏Ä ÏûëÏÑ±ÌïòÎäîÍ≥≥#}
                                        <div class="new-comment">
                                            {% csrf_token %}
                                            <input id="target_comment" type="text" placeholder="ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!"/>
                                            <button type="button" class="btn btn-light" id="comment-submit-button" onclick="save_comment()">
                                                ÏûëÏÑ±
                                            </button>
                                        </div>
                                    </li>
                                 {% else %}
                                     <div class="login_required">
                                        <div class="login_required_title">
                                            <h5>Î°úÍ∑∏Ïù∏ ÌõÑÏóê ÎåìÍ∏ÄÏùÑ ÏûëÏÑ± Ìï† Ïàò ÏûàÏäµÎãàÎã§.</h5>
                                        </div>
                                        <div class="login_required_content">
                                            <a href="{% url 'user:login' %}">
                                                <span><span style="font-weight: bold">Î°úÍ∑∏Ïù∏</span> ÏùÑ Ìï¥Î≥ºÍπå?</span>
                                            </a>
                                            <a href="{% url 'user:sign-up' %}" style="display: block">
                                                <span style="font-size: 0.8rem">ÏïÑÎãàÎ©¥</span>
                                                <span><span style="font-weight: bold">ÌöåÏõêÍ∞ÄÏûÖ</span> ÏùÑ Ìï¥Î≥ºÍπå?</span>
                                            </a>
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="content_botton">
                                        <button id="more_show_btn" onclick="open_comment() ">ÎçîÎ≥¥Í∏∞</button>
                                </div>
                                <div id="comment_content2">

                                </div>
                                {#                                    ÏûëÏÑ±Îêú ÎåìÍ∏ÄÏù¥ ÏûàÎäî Í≥≥#}
                                    <div id="comment_content" class="disp_none">
                                        <li class="timeline-item | extra-space">
                                            <div class="timeline-item-wrapper" id="comment_here">
                                                <br>
                                                {% for comment in target_comment %}
                                                <div class="comment_list_wrapper" id="{{ comment.pk }}">
                                                    <div class="timeline-item-description" id="comment_append">
                                                       <i class="avatar | small">
                                                            <img src="https://assets.codepen.io/285131/hat-man.png"/>
                                                        </i>
                                                        <span><a href="#">{{ comment.user.username }}</a>   ÏûëÏÑ±Îêú ÎÇ†Ïßú
                                                            <time
                                                                datetime="{{ comment.created_at }}">{{ comment.created_at|date:'Y-m-d H:i' }}
                                                            </time>
                                                        </span>
                                                    </div>
                                                    <div class="comment">
                                                        <p>
                                                            {{ comment.content }}
                                                        </p>
                                                    </div>
                                                </div>

                                                {% endfor %}
                                            </div>
                                        </li>
                                    </div>
                                </ol>
                                <div class="content_botton">
                                    <button id="less_show_btn" class="disp_none" onclick="close_comment()">Îã´Í∏∞</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--=======================Javascript============================-->

    {% include 'js.html' %}

</div>

</body>
{% include 'footer.html' %}

</html>